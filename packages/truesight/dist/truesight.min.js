/*!
 * truesight.min.js v0.1.0-alpha.1
 * Copyright (c) 2018-present, Chennara Nhes.
 * Released under the MIT License.
 */
!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):r.truesight=n()}(this,function(){"use strict";var r=r||{};r.Geometry=function(){},r.Geometry.intersectLineLine=function(r,n){var e=(r.intercept-n.intercept)/(n.slope-r.slope);return{x:e,y:r.slope*e+r.intercept}},r.Geometry.distanceFromOrigin=function(r){return Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2))},r.Geometry.distanceLineFromOrigin=function(r){return Math.abs(r.intercept)/Math.sqrt(Math.pow(r.slope,2)+1)},r.Geometry.perpendicularThroughPoint=function(r,n){var e=-1/r.slope;return{slope:e,intercept:n.y-e*n.x}},r.Geometry.angleFromOrigin=function(r){return Math.atan2(r.y,r.x)},r.Geometry.normalizeAngle=function(r){var n=2*Math.PI;return(r%n+n)%n},r.Geometry.lengthOfRayUntilIntersect=function(r,n){return n.intercept/(Math.sin(r)-n.slope*Math.cos(r))},r.Hsluv=function(){},r.Hsluv.getBounds=function(n){for(var e=[],t=Math.pow(n+16,3)/1560896,u=t>r.Hsluv.epsilon?t:n/r.Hsluv.kappa,o=0;o<3;)for(var i=o++,l=r.Hsluv.m[i][0],a=r.Hsluv.m[i][1],s=r.Hsluv.m[i][2],v=0;v<2;){var c=v++,f=(284517*l-94839*s)*u,h=(838422*s+769860*a+731718*l)*n*u-769860*c*n,g=(632260*s-126452*a)*u+126452*c;e.push({slope:f/g,intercept:h/g})}return e},r.Hsluv.maxSafeChromaForL=function(n){for(var e=r.Hsluv.getBounds(n),t=1/0,u=0;u<e.length;){var o=e[u];++u;var i=r.Geometry.distanceLineFromOrigin(o);t=Math.min(t,i)}return t},r.Hsluv.maxChromaForLH=function(n,e){for(var t=e/360*Math.PI*2,u=r.Hsluv.getBounds(n),o=1/0,i=0;i<u.length;){var l=u[i];++i;var a=r.Geometry.lengthOfRayUntilIntersect(t,l);a>=0&&(o=Math.min(o,a))}return o},r.Hsluv.dotProduct=function(r,n){for(var e=0,t=0,u=r.length;t<u;){var o=t++;e+=r[o]*n[o]}return e},r.Hsluv.fromLinear=function(r){return r<=.0031308?12.92*r:1.055*Math.pow(r,.4166666666666667)-.055},r.Hsluv.toLinear=function(r){return r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92},r.Hsluv.xyzToRgb=function(n){return[r.Hsluv.fromLinear(r.Hsluv.dotProduct(r.Hsluv.m[0],n)),r.Hsluv.fromLinear(r.Hsluv.dotProduct(r.Hsluv.m[1],n)),r.Hsluv.fromLinear(r.Hsluv.dotProduct(r.Hsluv.m[2],n))]},r.Hsluv.rgbToXyz=function(n){var e=[r.Hsluv.toLinear(n[0]),r.Hsluv.toLinear(n[1]),r.Hsluv.toLinear(n[2])];return[r.Hsluv.dotProduct(r.Hsluv.minv[0],e),r.Hsluv.dotProduct(r.Hsluv.minv[1],e),r.Hsluv.dotProduct(r.Hsluv.minv[2],e)]},r.Hsluv.yToL=function(n){return n<=r.Hsluv.epsilon?n/r.Hsluv.refY*r.Hsluv.kappa:116*Math.pow(n/r.Hsluv.refY,.3333333333333333)-16},r.Hsluv.lToY=function(n){return n<=8?r.Hsluv.refY*n/r.Hsluv.kappa:r.Hsluv.refY*Math.pow((n+16)/116,3)},r.Hsluv.xyzToLuv=function(n){var e=n[0],t=n[1],u=e+15*t+3*n[2],o=4*e,i=9*t;0!=u?(o/=u,i/=u):(o=NaN,i=NaN);var l=r.Hsluv.yToL(t);return 0==l?[0,0,0]:[l,13*l*(o-r.Hsluv.refU),13*l*(i-r.Hsluv.refV)]},r.Hsluv.luvToXyz=function(n){var e=n[0],t=n[1],u=n[2];if(0==e)return[0,0,0];var o=t/(13*e)+r.Hsluv.refU,i=u/(13*e)+r.Hsluv.refV,l=r.Hsluv.lToY(e),a=0-9*l*o/((o-4)*i-o*i);return[a,l,(9*l-15*i*l-i*a)/(3*i)]},r.Hsluv.luvToLch=function(r){var n,e=r[0],t=r[1],u=r[2],o=Math.sqrt(t*t+u*u);o<1e-8?n=0:(n=180*Math.atan2(u,t)/Math.PI)<0&&(n=360+n);return[e,o,n]},r.Hsluv.lchToLuv=function(r){var n=r[0],e=r[1],t=r[2]/360*2*Math.PI;return[n,Math.cos(t)*e,Math.sin(t)*e]},r.Hsluv.hsluvToLch=function(n){var e=n[0],t=n[1],u=n[2];return u>99.9999999?[100,0,e]:u<1e-8?[0,0,e]:[u,r.Hsluv.maxChromaForLH(u,e)/100*t,e]},r.Hsluv.lchToHsluv=function(n){var e=n[0],t=n[1],u=n[2];return e>99.9999999?[u,0,100]:e<1e-8?[u,0,0]:[u,t/r.Hsluv.maxChromaForLH(e,u)*100,e]},r.Hsluv.hpluvToLch=function(n){var e=n[0],t=n[1],u=n[2];return u>99.9999999?[100,0,e]:u<1e-8?[0,0,e]:[u,r.Hsluv.maxSafeChromaForL(u)/100*t,e]},r.Hsluv.lchToHpluv=function(n){var e=n[0],t=n[1],u=n[2];return e>99.9999999?[u,0,100]:e<1e-8?[u,0,0]:[u,t/r.Hsluv.maxSafeChromaForL(e)*100,e]},r.Hsluv.rgbToHex=function(n){for(var e="#",t=0;t<3;){var u=n[t++],o=Math.round(255*u),i=o%16,l=(o-i)/16|0;e+=r.Hsluv.hexChars.charAt(l)+r.Hsluv.hexChars.charAt(i)}return e},r.Hsluv.hexToRgb=function(n){n=n.toLowerCase();for(var e=[],t=0;t<3;){var u=t++,o=16*r.Hsluv.hexChars.indexOf(n.charAt(2*u+1))+r.Hsluv.hexChars.indexOf(n.charAt(2*u+2));e.push(o/255)}return e},r.Hsluv.lchToRgb=function(n){return r.Hsluv.xyzToRgb(r.Hsluv.luvToXyz(r.Hsluv.lchToLuv(n)))},r.Hsluv.rgbToLch=function(n){return r.Hsluv.luvToLch(r.Hsluv.xyzToLuv(r.Hsluv.rgbToXyz(n)))},r.Hsluv.hsluvToRgb=function(n){return r.Hsluv.lchToRgb(r.Hsluv.hsluvToLch(n))},r.Hsluv.rgbToHsluv=function(n){return r.Hsluv.lchToHsluv(r.Hsluv.rgbToLch(n))},r.Hsluv.hpluvToRgb=function(n){return r.Hsluv.lchToRgb(r.Hsluv.hpluvToLch(n))},r.Hsluv.rgbToHpluv=function(n){return r.Hsluv.lchToHpluv(r.Hsluv.rgbToLch(n))},r.Hsluv.hsluvToHex=function(n){return r.Hsluv.rgbToHex(r.Hsluv.hsluvToRgb(n))},r.Hsluv.hpluvToHex=function(n){return r.Hsluv.rgbToHex(r.Hsluv.hpluvToRgb(n))},r.Hsluv.hexToHsluv=function(n){return r.Hsluv.rgbToHsluv(r.Hsluv.hexToRgb(n))},r.Hsluv.hexToHpluv=function(n){return r.Hsluv.rgbToHpluv(r.Hsluv.hexToRgb(n))},r.Hsluv.m=[[3.240969941904521,-1.537383177570093,-.498610760293],[-.96924363628087,1.87596750150772,.041555057407175],[.055630079696993,-.20397695888897,1.056971514242878]],r.Hsluv.minv=[[.41239079926595,.35758433938387,.18048078840183],[.21263900587151,.71516867876775,.072192315360733],[.019330818715591,.11919477979462,.95053215224966]],r.Hsluv.refY=1,r.Hsluv.refU=.19783000664283,r.Hsluv.refV=.46831999493879,r.Hsluv.kappa=903.2962962,r.Hsluv.epsilon=.0088564516,r.Hsluv.hexChars="0123456789abcdef";var n={hsluvToRgb:r.Hsluv.hsluvToRgb,rgbToHsluv:r.Hsluv.rgbToHsluv,hpluvToRgb:r.Hsluv.hpluvToRgb,rgbToHpluv:r.Hsluv.rgbToHpluv,hsluvToHex:r.Hsluv.hsluvToHex,hexToHsluv:r.Hsluv.hexToHsluv,hpluvToHex:r.Hsluv.hpluvToHex,hexToHpluv:r.Hsluv.hexToHpluv,lchToHpluv:r.Hsluv.lchToHpluv,hpluvToLch:r.Hsluv.hpluvToLch,lchToHsluv:r.Hsluv.lchToHsluv,hsluvToLch:r.Hsluv.hsluvToLch,lchToLuv:r.Hsluv.lchToLuv,luvToLch:r.Hsluv.luvToLch,xyzToLuv:r.Hsluv.xyzToLuv,luvToXyz:r.Hsluv.luvToXyz,xyzToRgb:r.Hsluv.xyzToRgb,rgbToXyz:r.Hsluv.rgbToXyz,lchToRgb:r.Hsluv.lchToRgb,rgbToLch:r.Hsluv.rgbToLch},e=function(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")},t=function(){function r(r,n){for(var e=0;e<n.length;e++){var t=n[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}return function(n,e,t){return e&&r(n.prototype,e),t&&r(n,t),n}}(),u=Object.assign||function(r){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])}return r},o=function(){return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return function(r,n){var e=[],t=!0,u=!1,o=void 0;try{for(var i,l=r[Symbol.iterator]();!(t=(i=l.next()).done)&&(e.push(i.value),!n||e.length!==n);t=!0);}catch(r){u=!0,o=r}finally{try{!t&&l.return&&l.return()}finally{if(u)throw o}}return e}(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(r){if(Array.isArray(r)){for(var n=0,e=Array(r.length);n<r.length;n++)e[n]=r[n];return e}return Array.from(r)},l=function(){function r(n){e(this,r),this.channels=n}return t(r,[{key:"toString",value:function(){return this.channels.toString()}},{key:"toRGBColor",value:function(){var r=n.hsluvToRgb(this.channels).map(function(r){return Math.floor(255*r+.5)});return new c(r)}},{key:"hue",get:function(){return this.channels[a]}},{key:"saturation",get:function(){return this.channels[s]}},{key:"lightness",get:function(){return this.channels[v]}}],[{key:"fromString",value:function(n){var e=n.split(",").map(Number);return new r([e[0],e[1],e[2]])}}]),r}(),a=0,s=1,v=2,c=function(){function r(n){e(this,r),this.channels=n}return t(r,[{key:"toHSLuvColor",value:function(){var r=this.channels.map(function(r){return r/255}),e=n.rgbToHsluv(r);return new l(e)}},{key:"red",get:function(){return this.channels[f]}},{key:"green",get:function(){return this.channels[h]}},{key:"blue",get:function(){return this.channels[g]}}]),r}(),f=0,h=1,g=2;function H(r){return r instanceof HTMLImageElement?function(r){var n=document.createElement("canvas");return n.width=r.width,n.height=r.height,n.getContext("2d").drawImage(r,0,0,r.width,r.height),m(n)}(r):m(r)}function m(r){return r.getContext("2d").getImageData(0,0,r.width,r.height).data}var p=function(){function r(n){e(this,r),this.data=n}return t(r,null,[{key:"fromImageElement",value:function(n,e){for(var t=[],u=H(n),o=4*(e-1),i=o;i<u.length;i+=4+o){var l=new c([u[i+f],u[i+h],u[i+g]]);t.push(l)}return new r(t)}}]),r}(),T=new(function(){function r(n,t){e(this,r),this.highest=n,this.lowest=t}return t(r,[{key:"toString",value:function(){return"["+this.highest+", "+this.lowest+"]"}}]),r}())(1,25),b=8,y=1;function d(r){return r.rgbImage||r.imageElement?r.rgbImage?function(r){if(!(r.rgbImage instanceof p))return new TypeError("image should be of type RGBImage");return x(r)}(r):function(r){var n=r.imageElement;if(!(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement))return new TypeError("imageElement should be of type HTMLImageElement or HTMLCanvasElement");return x(r)}(r):new RangeError("parameters should include either rgbImage or imageElement property")}function x(r){var n=r.numberOfColors,e=void 0===n?b:n,t=r.quality,u=void 0===t?y:t;return Number.isInteger(e)?e>=1&&e<=256?Number.isInteger(u)?u>=T.highest&&u<=T.lowest?r.rgbImage?{rgbImage:r.rgbImage,numberOfColors:e,quality:u}:{imageElement:r.imageElement,numberOfColors:e,quality:u}:new RangeError("quality should lie in "+T.toString()):new TypeError("quality should be an integer"):new RangeError("numberOfColors should lie in [1, 256]"):new TypeError("numberOfColors should be an integer")}function L(r,n){var e=d(r);return e instanceof Error?e:n(function(r,n){for(var e=[r.data],t=0;t<n-1;t+=1){var u=M(e),o=w(u),i=E(u,o);e.splice(e.indexOf(u),1),e=e.concat(i)}return e}(function(r){return r.rgbImage?r.rgbImage:p.fromImageElement(r.imageElement,r.quality)}(e),e.numberOfColors))}function M(r){return r.reduce(function(r,n){return n.length>r.length?n:r})}function w(r){var n=function(){function r(n){e(this,r),this.axis=n,this.minMax=[255,0]}return t(r,[{key:"updateMinMax",value:function(r){this.minMax=[Math.min(r,this.minMax[0]),Math.max(r,this.minMax[1])]}},{key:"width",get:function(){return this.minMax[1]-this.minMax[0]}}]),r}(),u=[new n(f),new n(h),new n(g)];return r.forEach(function(r){u[f].updateMinMax(r.red),u[h].updateMinMax(r.green),u[g].updateMinMax(r.blue)}),u.reduce(function(r,n){return n.width>r.width?n:r}).axis}function E(r,n){return function(r,n,e){return r.reduce(function(r,t){return r[function(r){return r.channels[n]<=e?0:1}(t)].push(t),r},[[],[]])}(r,n,function(r,n){var e=r.map(function(r){return r.channels[n]}).sort(function(r,n){return r-n});return e[Math.floor(e.length/2)-1]}(r,n))}function I(r){var n,e=r.map(function(r){var n=C(r);return r.map(function(r){return{sourceColor:r,representativeColor:n}})});return(n=[]).concat.apply(n,i(e))}function R(r){return r.map(function(r){return{color:C(r),population:r.length}})}function C(r){var n=r.reduce(function(r,n){return[r[f]+n.red,r[h]+n.green,r[g]+n.blue]},[0,0,0]).map(function(n){return Math.floor(n/r.length+.5)});return new c([n[f],n[h],n[g]])}var z=function(){function r(n){e(this,r),this.data=n}return t(r,null,[{key:"fromRGBImage",value:function(n,e){for(var t=[],u=e-1,o=u;o<n.data.length;o+=1+u){var i=[n.data[o].red,n.data[o].green,n.data[o].blue],l=new c(i).toHSLuvColor();t.push(l)}return new r(t)}},{key:"fromImageElement",value:function(n,e){for(var t=[],u=H(n),o=4*(e-1),i=o;i<u.length;i+=4+o){var l=[u[i+f],u[i+h],u[i+g]],a=new c(l).toHSLuvColor();t.push(a)}return new r(t)}}]),r}(),S=[15,20,20];function O(r){var n=r.regionSize,e=void 0===n?S:n,t=o(e,3),i=t[0],l=t[1],a=t[2];if(3!==e.length)return RangeError("regionSize should be of type [number, number, number]");if(!Number.isInteger(i))return TypeError("hue in regionSize should be an integer");if(!(i>=1&&i<=360))return RangeError("hue in regionSize should lie in [1, 360]");if(!Number.isInteger(l))return TypeError("saturation in regionSize should be an integer");if(!(l>=1&&l<=100))return RangeError("saturation in regionSize should lie in [1, 100]");if(!Number.isInteger(a))return TypeError("lightness in regionSize should be an integer");if(!(a>=1&&a<=100))return RangeError("lightness in regionSize should lie in [1, 100]");var s=function(r){if(r.rgbImage){var n=r.rgbImage,e=r.numberOfColors,t=r.quality;return d({rgbImage:n,numberOfColors:e,quality:t})}var u=r.imageElement,o=r.numberOfColors,i=r.quality;return d({imageElement:u,numberOfColors:o,quality:i})}(r);return s instanceof Error?s:u({},s,{regionSize:e})}function k(r,n){for(var e=0;n>=r[e]&&e<r.length;)e+=1;return[r[e-1],r[e]].toString()}function q(r){return r.reduce(function(r,n){return r+n[1]},0)}return u({},{quantize:function(r){return L(r,I)},reduce:function(r){return L(r,R)},popularize:function(r){var n=O(r);if(n instanceof Error)return n;var e,t,u,o=function(r){return r.rgbImage?z.fromRGBImage(r.rgbImage,r.quality):z.fromImageElement(r.imageElement,r.quality)}(n);return e=o,t=n.regionSize,u=n.numberOfColors,function(r,n){return function(r,n){var e=r.map(function(r){return{regionID:r[0],population:q(r[1])}});e.sort(function(r,n){return n.population-r.population});var t=e.slice(0,n).map(function(r){return r.regionID});return r.filter(function(r){return t.includes(r[0])})}(r,n).map(function(r){return{color:(n=r[1]).map(function(r){return{color:l.fromString(r[0]),population:r[1]}}).reduce(function(r,n){return n.population>r.population?n:r}).color.toRGBColor(),population:q(n)};var n})}(function(r,n){var e=new Map;return r.data.forEach(function(r){var t=function(r,n){for(var e=[],t=0;t<360+n[a];t+=n[a])e.push(Math.min(t,360));for(var u=[],o=0;o<100+n[s];o+=n[s])u.push(Math.min(o,100));for(var i=[],l=0;l<100+n[v];l+=n[v])i.push(Math.min(l,100));return[k(e,r.hue),k(u,r.saturation),k(i,r.lightness)].join(",")}(r,n),u=r.toString(),o=e.get(t);if(o){var i=o.get(u);i?o.set(u,i+1):o.set(u,1)}else e.set(t,new Map([[u,1]]))}),Array.from(e.entries()).map(function(r){return[r[0],Array.from(r[1].entries()).map(function(r){return[r[0],r[1]]})]})}(e,t),u)}},{RGBImage:p})});
